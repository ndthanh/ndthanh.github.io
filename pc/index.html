<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Production Flow Control</title>
    <style type="text/css">
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.0.3/html5-qrcode.min.js"></script>
  </head>
    <body>
    <div style="width: 320px; margin: 0 auto;" id="reader"></div>
    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbz6ovNhUYQ0rVbZO5rIgwFOC5fkCprpaKfPUqHuzg_83c9E0Lwaq82EghRlB7plYXgbyw/exec";
        const urlParams = new URLSearchParams(window.location.search);
        const ws = urlParams.get('ws');
      
        const html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 30, qrbox: 250 });
        
        async function onScanSuccess(qrCodeMessage) {
            const options = {
              method: 'POST',
              contentType: 'application/json',
              body: JSON.stringify({ ws: ws, class: qrCodeMessage })
            };

            const response = await fetch(API_URL, options);
            if (response.getResponseCode() == 200) {
              const res = JSON.parse(response.getContentText())
              html5QrcodeScanner.clear();
              alert(response.getContentText())
            } else {
              alert('else');
              html5QrcodeScanner.clear();
            }
        }

        html5QrcodeScanner.render(onScanSuccess);
    </script>
    </body>
</html>
