<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Production Flow Control</title>
    <style type="text/css">
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.0.3/html5-qrcode.min.js"></script>
  </head>
    <body>
    <input style="width: 320px; margin: 0 auto;" type="text" name="workstation" class="workstation" placeholder="Work Station">
    <button style="width: 320px; margin: 0 auto;" id="save-work-station">Start Scan</button>
    <div style="width: 320px; margin: 0 auto;" id="reader"></div>
    <script>

        const API_URL = "https://script.google.com/macros/s/AKfycbz6ovNhUYQ0rVbZO5rIgwFOC5fkCprpaKfPUqHuzg_83c9E0Lwaq82EghRlB7plYXgbyw/exec";
        
        const html5QrCode = new Html5Qrcode("reader");
        const config = { fps: 5, qrbox: 250 };
      
        const qrCodeSuccessCallback = message => { onScanSuccess(message) }
        
        async function onScanSuccess(qrCodeMessage) {
            html5QrCode.stop(); 
            const options = {
              method: 'POST',
              contentType: 'application/json',
              body: JSON.stringify({ ws: document.querySelector('.workstation').value, class: qrCodeMessage })
            };

            const response = await fetch(API_URL, options)
              .then(response => response.json())
              .then(data => {
                  alert(data.message)
                  window.location.reload(false);
              });
        }
        function startScan() {
          html5QrCode.start({ facingMode: "environment" }, config, qrCodeSuccessCallback);
        }
        document.getElementById('save-work-station').addEventListener('click', startScan)
    </script>
    </body>
</html>
